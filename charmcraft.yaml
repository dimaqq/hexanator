---
name: hexanator
type: charm
title: Charmed Gubernator
summary: High-performance, distributed rate-limiting service
description: |
  Gubernator is a high-performance, distributed rate-limiting service.

# charmcraft 3.0
base: ubuntu@24.04
build-base: ubuntu@24.04
platforms:
  amd64:
  arm64:
# Work-around from https://discourse.charmhub.io/t/charmcraft-3-0-in-the-beta-channel/13469/5?u=dimaqq
parts:
  charm:
    plugin: charm
    source: .

# FIXME: move to 24.04 when there's a working Juju release
bases:
  - build-on:
      - name: ubuntu
        channel: "22.04"
        architectures: [amd64, arm64, riscv64]
    run-on:
      - name: ubuntu
        channel: "22.04"
        architectures: [amd64, arm64, riscv64]

# FIXME: unused for now, push the log level into pebble config
config:
  options:
    log-level:
      description: |
        Acceptable values are: "info", "debug", "warning", "error" and "critical"
      default: "info"
      type: string

containers:
  gubernator:
    resource: gubernator

resources:
  gubernator:
    type: oci-image
    description: Gubernator Rock with Pebble
      # FIXME move to 3.0.0 even if still in beta
    upstream-source: docker.io/dimaqq/gubernator:2.7.5

links:
  source: https://github.com/gubernator-io/gubernator

requires:
  ingress:
    interface: ingress
    limit: 1
provides:
  rate-limiting:
    interface: http
